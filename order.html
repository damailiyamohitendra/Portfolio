<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brofic - Order</title>
  <link rel="stylesheet" href="css/style.css">
  <style>#orderMsg{margin-top:12px;font-weight:600}</style>
</head>
<body>

<header>
  <a href="index.html" class="logo"><img src="assets/images/logo.png" alt="Brofic Logo"></a>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
      <li><a href="order.html">Order</a></li>
      <li><a href="feedback.html">Feedback</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- cursor trail container -->
<div id="trail" class="trail"></div>

<!-- Hidden iframe used as the form target (prevents navigation & avoids CORS) -->
<iframe id="submitTarget" name="submitTarget" style="display:none;"></iframe>

<section>
  <h2 class="section-title">Place Your Order</h2>

  <!--
    Note:
    - action will be set via JS below to your Apps Script URL (APPS_SCRIPT_URL_HERE).
    - form fields include name attributes so Apps Script receives them in e.parameter.
  -->
  <form id="orderForm" method="post" target="submitTarget" action="">
    <!-- Hidden meta fields (populated by JS at submit) -->
    <input type="hidden" name="token" value="" />
    <input type="hidden" name="timestamp" value="" />
    <input type="hidden" name="date" value="" />
    <input type="hidden" name="time" value="" />
    <input type="hidden" name="human_readable" value="" />

    <label for="name">Full Name</label>
    <input type="text" id="name" name="name" placeholder="Enter your name" required>

    <label for="email">Email Address</label>
    <input type="email" id="email" name="email" placeholder="Enter your email" required>

    <!-- NEW: Contact number -->
    <label for="phone">Contact Number</label>
    <input type="tel" id="phone" name="phone" placeholder="+91 98765 43210" pattern="[\d+\-\s\(\)]{6,25}" title="Enter a valid phone number" required>

    <label for="service">Select Service</label>
    <select id="service" name="service" required>
      <option value="">-- Choose a Service --</option>
      <option value="Logo Design">Logo Design</option>
      <option value="Poster Design">Poster Design</option>
      <option value="Wedding Invitation">Wedding Invitation</option>
      <option value="Business Card">Business Card</option>
      <option value="Social Media Graphics">Social Media Graphics</option>
    </select>

    <label for="details">Project Details</label>
    <textarea id="details" name="details" rows="4" placeholder="Describe your requirements..."></textarea>

    <button type="submit" id="submitBtn">Submit Order</button>
    <div id="orderMsg" role="status" aria-live="polite"></div>
  </form>

</section>

<footer class="simple-footer">
  <p>© <span id="year"></span> Brofic | All Rights Reserved</p>
  <div class="footer-icons">
    <!-- (your social icons here; kept the same for brevity) -->
    <!-- ... -->
  </div>
</footer>

<!-- Scripts -->
<script>
  // ====== CONFIG: replace these ======
  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzKA1SQNrdM3K4tH1JeU2Hz9QNdf3gu_Vd8kj5duOjR5zvqwv1Jt2QdmEtHKKR03iSI/exec"; // <-- paste your deployed Apps Script web app URL
  const CLIENT_TOKEN = "paste_a_long_secret_here_CHANGE_ME";        // <-- replace with your EXPECTED_TOKEN (or leave blank if you didn't use one)
  // ==================================

  // wire the form action & token hidden field
  const orderForm = document.getElementById('orderForm');
  orderForm.action = APPS_SCRIPT_URL;
  const tokenInput = orderForm.querySelector('input[name="token"]');
  if (CLIENT_TOKEN && tokenInput) tokenInput.value = CLIENT_TOKEN;

  // basic UX: display sending / success messages
  const orderMsg = document.getElementById('orderMsg');
  const submitBtn = document.getElementById('submitBtn');
  const iframe = document.getElementById('submitTarget');

  // fallback timer handle (cleared on iframe load)
  let fallbackTimer = null;

  orderForm.addEventListener('submit', function(e){
    // populate timestamp fields immediately before submit
    const now = new Date();
    orderForm.querySelector('input[name="timestamp"]').value = now.toISOString();
    orderForm.querySelector('input[name="date"]').value = now.toLocaleDateString();
    orderForm.querySelector('input[name="time"]').value = now.toLocaleTimeString();
    orderForm.querySelector('input[name="human_readable"]').value = now.toLocaleString();

    // UX
    orderMsg.style.color = '#fff';
    orderMsg.textContent = 'Sending order...';
    submitBtn.disabled = true;

    // if iframe doesn't load within X seconds, show an advisory message and re-enable
    if (fallbackTimer) clearTimeout(fallbackTimer);
    fallbackTimer = setTimeout(function(){
      orderMsg.style.color = 'salmon';
      orderMsg.textContent = '⚠️ No response detected — if the order is not in the sheet, please try again or contact us.';
      submitBtn.disabled = false;
      fallbackTimer = null;
    }, 15000); // 15s
  });

  // When the hidden iframe finishes loading, treat it as success (can't read cross-origin body)
  iframe.addEventListener('load', function(){
    if (fallbackTimer) { clearTimeout(fallbackTimer); fallbackTimer = null; }
    orderMsg.style.color = 'lightgreen';
    orderMsg.textContent = '✅ Order submitted — thank you! We will contact you soon.';
    orderForm.reset();
    submitBtn.disabled = false;
  });

  // small helpers: year and nav highlighter (kept from original)
  document.getElementById('year').textContent = new Date().getFullYear();
  (function highlightActiveNav(){
    const links = document.querySelectorAll('nav ul li a');
    let current = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    links.forEach(a => a.classList.toggle('active', (a.getAttribute('href').split('/').pop() || '').toLowerCase() === current));
  })();
</script>

</body>
</html>
